<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>For developers • casteval</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="For developers">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">casteval</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/casteval.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/dev.html">For developers</a></li>
    <li><a class="dropdown-item" href="../articles/scoring.html">Scoring forecasts</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/phac-nml-phrsd/casteval/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>For developers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/phac-nml-phrsd/casteval/blob/main/vignettes/articles/dev.Rmd" class="external-link"><code>vignettes/articles/dev.Rmd</code></a></small>
      <div class="d-none name"><code>dev.Rmd</code></div>
    </div>

    
    
<p>Please review the following if you are preparing to contribute to
<a href="https://phac-nml-phrsd.github.io/casteval">casteval</a>.</p>
<div class="section level2">
<h2 id="design-goals">Design goals<a class="anchor" aria-label="anchor" href="#design-goals"></a>
</h2>
<p>We strive to design <a href="https://phac-nml-phrsd.github.io/casteval">casteval</a> to be robust, flexible,
and modular.</p>
<div class="section level3">
<h3 id="robustness">Robustness<a class="anchor" aria-label="anchor" href="#robustness"></a>
</h3>
<p><a href="https://phac-nml-phrsd.github.io/casteval">casteval</a> shouldn’t break easily, so we build in a lot
of input validation and try to give informative error
messages/warnings.</p>
</div>
<div class="section level3">
<h3 id="flexibility">Flexibility<a class="anchor" aria-label="anchor" href="#flexibility"></a>
</h3>
<p><a href="https://phac-nml-phrsd.github.io/casteval">casteval</a> should accept a variety of inputs easily and
should function for a variety of realistic use cases. The user should
not have to do a lot of wrangling of data/parameters to get the software
to work for them.</p>
<p>For example:</p>
<ul>
<li>
<code><a href="../reference/accuracy.html">accuracy()</a></code>’s <code>quant_pairs</code> argument can
accept either <code>NULL</code>, a pair of quantiles, or a list of pairs
of quantiles, and it handles all of these inputs in a reasonable
fashion.</li>
<li>
<code><a href="../reference/plot_forecast.html">plot_forecast()</a></code> only requires a forecast as input, but
can additionally accept observations, quantile intervals, and a scoring
function, depending on what the user seeks to accomplish.</li>
</ul>
</div>
<div class="section level3">
<h3 id="modularity">Modularity<a class="anchor" aria-label="anchor" href="#modularity"></a>
</h3>
<p>It should be easy to combine, swap out, or customize
<a href="https://phac-nml-phrsd.github.io/casteval">casteval</a>’s outputs.</p>
<p>For example:</p>
<ul>
<li>User-defined scoring functions are compatible with the existing
plotting functions, as long as they follow the syntax and return
format.</li>
<li>Some of the <code>plot_*()</code> functions (<em>e.g.</em>,
<code><a href="../reference/plot_ensemble.html">plot_ensemble()</a></code>, <code><a href="../reference/plot_observations.html">plot_observations()</a></code>) can be
chained together via the pipe operator <code>|&gt;</code>, which enables
the user to customize the order of their their plot layers more easily
(compared to simply using <code><a href="../reference/plot_forecast.html">plot_forecast()</a></code>).</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="section level3">
<h3 id="renv">
<code>renv</code><a class="anchor" aria-label="anchor" href="#renv"></a>
</h3>
<p>This project uses <a href="https://rstudio.github.io/renv/index.html" class="external-link"><code>renv</code></a>
to manage dependencies.</p>
<p>For R package projects, <code>renv</code> tries to intelligently
discover dependencies by looking at the fields in the DESCRIPTION file
that are relevant for users, like <code>Imports</code> and
<code>Depends</code> (see
<code>renv::settings$package.dependency.fields()</code>). For
developers, the <code>Suggests</code> field can be equally important to
track as it can include packages used in the process of development but
not in the actual source code of the package, like
<code>devtools</code>, <code>covr</code>, to ensure development
environments don’t vary across users.</p>
<p>The <code>renv</code> FAQ page <a href="https://rstudio.github.io/renv/articles/faq.html#how-should-i-handle-development-dependencies" class="external-link">recommends
tracking development dependencies in <code>Suggests</code></a>. It
doesn’t, however, seem to tell you that in order to use their
recommendation, you need to use the <code>dev = TRUE</code> flag in
<code><a href="https://rstudio.github.io/renv/reference/status.html" class="external-link">renv::status()</a></code> to accurately check the status of such a
project, as well as in <code><a href="https://rstudio.github.io/renv/reference/snapshot.html" class="external-link">renv::snapshot()</a></code> when recording
files (the default is <code>dev = FALSE</code>). If you simply execute
<code>renv::snapshot(dev = FALSE)</code>, <code>renv</code> will
miss/remove the development dependencies in <code>Suggests</code>, which
will break our CI pipelines. Once these dependencies have been recorded,
<code>renv::status(dev = FALSE)</code> will report that the project is
out-of-sync, as it will see installed dependencies that are not used
anywhere (since it skips <code>Suggests</code>).</p>
<p>The bottom line is to be sure to use the <code>dev = TRUE</code>
option when working in this repository. If you need to add any
development dependencies to the project, be sure to add them to the
<code>Suggests</code> field of the <code>DESCRIPTION</code>, run
<code>renv::install(dev = TRUE)</code> to install them, then
<code>renv::snapshot(dev = TRUE)</code> to record them.</p>
<p>A side effect of this default behaviour is that, when you open a new
R session in this project, <code><a href="https://rstudio.github.io/renv/reference/status.html" class="external-link">renv::status()</a></code> will get called
and report that the project is out-of-sync. Don’t trust this message!
Run <code>renv::status(dev = TRUE)</code> to check the true status of
the project. (There is a <a href="https://github.com/rstudio/renv/issues/1760" class="external-link">feature request</a>
to enable a user to configure the default behaviour of
<code><a href="https://rstudio.github.io/renv/reference/status.html" class="external-link">renv::status()</a></code> on a project-by-project basis specifically
to accommodate the above situation, but this issue is still open as of
this writing on 2024-08-26…)</p>
</div>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<div class="section level3">
<h3 id="git">git<a class="anchor" aria-label="anchor" href="#git"></a>
</h3>
<p>There are two important branches in the repository: <code>main</code>
and <code>dev</code>.</p>
<p>We intend for <code>main</code> to be the branch that users install
from, and so it should be well-test and free of work-in-progress
code.</p>
<p><code>dev</code> is the main development branch that acts as a
staging area for new changes going into <code>main</code>:</p>
<ol style="list-style-type: decimal">
<li>A developer should start new features or bug fixes by branching from
<code>dev</code>, with a succinct branch name that describes the
branch’s use (<em>e.g.</em>, <code>plot-grouped-forecasts</code>).</li>
<li>Once work is complete on the feature- or issue-specific branch, the
develop should create a pull request into <code>dev</code>.</li>
<li>The package maintainer should then decide on the next release
version of the package (following the <a href="https://semver.org/" class="external-link">semantic versioning paradigm</a>) and accept
the pull request(s) that is/are to be a part of this release into
<code>dev</code>.</li>
<li>The package maintainer should then pull <code>main</code> into
<code>dev</code> to sync and resolve any merge conflicts.</li>
<li>The package maintainer should create a branch from <code>dev</code>
called <code>vx.y.z</code>, where <code>x.y.z</code> is the desired
version number and then update the version number in
<code>DESCRIPTION</code> as well. This last commit should be tagged with
the version number.</li>
<li>The package maintainer should finish by creating and accepting a
pull request from the version-specific branch to <code>main</code> and
by <a href="https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository" class="external-link">creating
a release</a> (if there is a change in the major or minor version
number).</li>
</ol>
</div>
<div class="section level3">
<h3 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h3>
<p>Developers can use <code><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">pkgdown::build_site()</a></code> to preview the
entire package website based on the current state of the package
documentation.</p>
<p>It is also useful to use the commands
<code><a href="https://pkgdown.r-lib.org/reference/build_reference.html" class="external-link">pkgdown::build_reference()</a></code> and
<code><a href="https://pkgdown.r-lib.org/reference/build_articles.html" class="external-link">pkgdown::build_articles()</a></code> to preview just the Reference
(function documentation) and Articles pages, respectively. However, in
the latter case at least, <code>pkgdown</code> will use the currently
installed version of the package, not the current source version, so you
may want to run <code><a href="https://devtools.r-lib.org/reference/install.html" class="external-link">devtools::install()</a></code> first if you’re working
on a part of an article that depends on the latest version of the
<a href="https://phac-nml-phrsd.github.io/casteval">casteval</a> code.</p>
<p>The results will appear in <code>public/</code>, which is only for
local previews and should not be pushed to the remote repository (it
should be in <code>.gitignore</code> already). We rebuild and deploy the
package website automatically with GitHub Actions whenever changes are
pushed to <code>main</code>.</p>
<div class="section level4">
<h4 id="readme">README<a class="anchor" aria-label="anchor" href="#readme"></a>
</h4>
<p><code>README.md</code> is used as the README on GitHub as well as on
the landing page for the package website. Its source is
<code>README.Rmd</code>; any updates to the README content should be
made in the <code>.Rmd</code> and then <code>README.md</code> should be
regenerated with <code><a href="https://devtools.r-lib.org/reference/build_rmd.html" class="external-link">devtools::build_readme()</a></code>.</p>
<p>(Alternatively, we could create a GitHub Action to build the README
before deploying the website…)</p>
</div>
</div>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a>
</h3>
<p>We use <code>testthat</code> for most unit tests and
<code>vdiffr</code> (in particular,
<code><a href="https://vdiffr.r-lib.org/reference/expect_doppelganger.html" class="external-link">vdiffr::expect_doppelganger()</a></code>) for tests involving plots as
outputs.</p>
<p><code>vdiffr</code> sometimes deletes test snapshots when tests fail,
which is not that great (you might be able to avoid this by putting each
<code>expect_doppelganger()</code> in a separate
<code>test_that()</code> block, although that sounds tedious).</p>
</div>
<div class="section level3">
<h3 id="before-release">Before release<a class="anchor" aria-label="anchor" href="#before-release"></a>
</h3>
<p>You should use <code><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">devtools::check()</a></code>,
<code>renv::status(dev=TRUE)</code>, and <code><a href="http://covr.r-lib.org/reference/report.html" class="external-link">covr::report()</a></code> to
verify that the package is in a good state, especially before releasing
a new version.</p>
<ul>
<li>
<code><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">devtools::check()</a></code> checks that the package can be
installed, that unit tests pass, and a few other</li>
<li>
<code>renv::status(dev=TRUE)</code> checks that the virtual
environment used for development is in a consistent state</li>
<li>
<code><a href="http://covr.r-lib.org/reference/report.html" class="external-link">covr::report()</a></code> reports the current test coverage of the
package (note that there is <a href="https://github.com/phac-nml-phrsd/casteval/issues/2" class="external-link">a known issue
with <code>covr</code> and <code>vdiffr</code></a>)</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Yu, Irena Papst.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
