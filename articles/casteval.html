<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Evaluate time series forecasts with casteval • casteval</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Evaluate time series forecasts with casteval">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">casteval</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/casteval.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/scoring.html">Scoring forecasts</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Evaluate time series forecasts with casteval</h1>
            
      

      <div class="d-none name"><code>casteval.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><a href="https://phac-nml-phrsd.github.io/casteval">casteval</a> is an R package that helps you automate the
evaluation of time series forecasts. It provides functionality for
formatting, processing, scoring, and visualizing forecasts.</p>
<p>A typical workflow using <a href="https://phac-nml-phrsd.github.io/casteval">casteval</a> is:</p>
<ol style="list-style-type: decimal">
<li>
<a href="#create-a-forecast-object"><strong>Create a forecast
object</strong></a> by inputting a forecast and its metadata into
<code><a href="../reference/create_forecast.html">create_forecast()</a></code>
</li>
<li>
<a href="#score-a-forecast"><strong>Score the forecast</strong></a>
using <code><a href="../reference/score.html">score()</a></code>, which accepts forecast object(s),
corresponding observations, and a particular scoring function</li>
<li>
<a href="#visualize-forecast-evaluation"><strong>Visualize the
forecast</strong></a> using <code><a href="../reference/plot_forecast.html">plot_forecast()</a></code> with a scored
forecast and observations</li>
</ol>
<p>This vignette guides you through this process.
<!-- In this vignette, we demonstrate `{casteval}`'s main functionality via deliberately simple examples.
For a more realistic start-to-finish demonstration of the package's usage with real forecasts, please see [`vignette("denmark2020")`](denmark2020.html). --></p>
</div>
<div class="section level2">
<h2 id="create-a-forecast-object">Create a forecast object<a class="anchor" aria-label="anchor" href="#create-a-forecast-object"></a>
</h2>
<p>In order to create a forecast object, a forecast must first be cast
in one of the accepted formats, namely as a <a href="#forecast-data-frame">data frame</a> or as a <a href="#forecast-list">list</a>.</p>
<div class="section level3">
<h3 id="forecast-data-frame">Forecast input as data frames<a class="anchor" aria-label="anchor" href="#forecast-data-frame"></a>
</h3>
<p><strong>Forecast data frames</strong> must contain:</p>
<ol style="list-style-type: decimal">
<li>a <code>time</code> column, which can contain either numbers, dates,
or date-times</li>
<li>forecast data, which can be passed as raw or summarized.</li>
</ol>
<p><strong>Raw forecast data</strong> are the individual realizations of
a model. <strong>Summarized forecast data</strong> describes an ensemble
of realizations by quantiles computed for each time point.</p>
<div class="section level4">
<h4 id="raw-forecast-data">Raw forecast data<a class="anchor" aria-label="anchor" href="#raw-forecast-data"></a>
</h4>
<p>Raw forecast data must be passed in a column named <code>val</code>.
A <code>sim</code> column may be provided optionally to identify
different realizations (enables some scoring and plotting features).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># raw forecast over with numeric times, without simulation numbers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,each<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  val<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">100</span>, <span class="fl">110</span>, <span class="fl">120</span>, <span class="fl">130</span>, <span class="fl">140</span>,</span>
<span>    <span class="fl">101</span>, <span class="fl">111</span>, <span class="fl">121</span>, <span class="fl">131</span>, <span class="fl">141</span>,</span>
<span>    <span class="fl">102</span>, <span class="fl">112</span>, <span class="fl">122</span>, <span class="fl">132</span>, <span class="fl">142</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    time val</span></span>
<span><span class="co">#&gt; 1     1 100</span></span>
<span><span class="co">#&gt; 2     1 110</span></span>
<span><span class="co">#&gt; 3     1 120</span></span>
<span><span class="co">#&gt; 4     2 130</span></span>
<span><span class="co">#&gt; 5     2 140</span></span>
<span><span class="co">#&gt; 6     2 101</span></span>
<span><span class="co">#&gt; 7     3 111</span></span>
<span><span class="co">#&gt; 8     3 121</span></span>
<span><span class="co">#&gt; 9     3 131</span></span>
<span><span class="co">#&gt; 10    4 141</span></span>
<span><span class="co">#&gt; 11    4 102</span></span>
<span><span class="co">#&gt; 12    4 112</span></span>
<span><span class="co">#&gt; 13    5 122</span></span>
<span><span class="co">#&gt; 14    5 132</span></span>
<span><span class="co">#&gt; 15    5 142</span></span>
<span><span class="co"># raw forecast data with dates, with simulation numbers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  sim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  time<span class="op">=</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  val<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">100</span>, <span class="fl">110</span>, <span class="fl">120</span>, <span class="fl">130</span>, <span class="fl">140</span>,</span>
<span>    <span class="fl">101</span>, <span class="fl">111</span>, <span class="fl">121</span>, <span class="fl">131</span>, <span class="fl">141</span>,</span>
<span>    <span class="fl">102</span>, <span class="fl">112</span>, <span class="fl">122</span>, <span class="fl">132</span>, <span class="fl">142</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    sim       time val</span></span>
<span><span class="co">#&gt; 1    1 1970-01-02 100</span></span>
<span><span class="co">#&gt; 2    1 1970-01-03 110</span></span>
<span><span class="co">#&gt; 3    1 1970-01-04 120</span></span>
<span><span class="co">#&gt; 4    1 1970-01-05 130</span></span>
<span><span class="co">#&gt; 5    1 1970-01-06 140</span></span>
<span><span class="co">#&gt; 6    2 1970-01-02 101</span></span>
<span><span class="co">#&gt; 7    2 1970-01-03 111</span></span>
<span><span class="co">#&gt; 8    2 1970-01-04 121</span></span>
<span><span class="co">#&gt; 9    2 1970-01-05 131</span></span>
<span><span class="co">#&gt; 10   2 1970-01-06 141</span></span>
<span><span class="co">#&gt; 11   3 1970-01-02 102</span></span>
<span><span class="co">#&gt; 12   3 1970-01-03 112</span></span>
<span><span class="co">#&gt; 13   3 1970-01-04 122</span></span>
<span><span class="co">#&gt; 14   3 1970-01-05 132</span></span>
<span><span class="co">#&gt; 15   3 1970-01-06 142</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="summarized-forecast-data">Summarized forecast data<a class="anchor" aria-label="anchor" href="#summarized-forecast-data"></a>
</h4>
<p>Summarized forecast data may be stored in the following columns:</p>
<ul>
<li>Quantile columns must start with <code>val_q</code> followed by a
number from 0 to 100, <em>e.g.</em>, <code>val_50</code> would be the
50th quantile, <em>i.e.</em>, the median</li>
<li>The mean column must be named <code>val_mean</code>
</li>
</ul>
<p>Note that summarized data never contains a <code>sim</code>
column.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># summarized forecast data with the 25th, 50th, and 75th percentiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time<span class="op">=</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_datetime</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  val_q25<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">105</span>,<span class="fl">103</span>,<span class="fl">104</span>,<span class="fl">105</span><span class="op">)</span>,</span>
<span>  val_q50<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">201</span>, <span class="fl">210</span>, <span class="fl">205</span>, <span class="fl">201</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>  val_q75<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">304</span>, <span class="fl">305</span>, <span class="fl">303</span>, <span class="fl">303</span>, <span class="fl">302</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;                  time val_q25 val_q50 val_q75</span></span>
<span><span class="co">#&gt; 1 1970-01-01 00:00:01     100     201     304</span></span>
<span><span class="co">#&gt; 2 1970-01-01 00:00:02     105     210     305</span></span>
<span><span class="co">#&gt; 3 1970-01-01 00:00:03     103     205     303</span></span>
<span><span class="co">#&gt; 4 1970-01-01 00:00:04     104     201     303</span></span>
<span><span class="co">#&gt; 5 1970-01-01 00:00:05     105     200     302</span></span>
<span><span class="co"># summarized forecast data with the mean, and the 2.5th and 97.5th percentiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  val_q2.5<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">103</span>,<span class="fl">104</span>,<span class="fl">105</span>,<span class="fl">102</span><span class="op">)</span>,</span>
<span>  val_mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>,<span class="fl">155</span>,<span class="fl">160</span>,<span class="fl">155</span>,<span class="fl">154</span><span class="op">)</span>,</span>
<span>  val_97.5<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">200</span>,<span class="fl">2204</span>,<span class="fl">205</span>,<span class="fl">206</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   time val_q2.5 val_mean val_97.5</span></span>
<span><span class="co">#&gt; 1    1      100      150      200</span></span>
<span><span class="co">#&gt; 2    2      103      155      200</span></span>
<span><span class="co">#&gt; 3    3      104      160     2204</span></span>
<span><span class="co">#&gt; 4    4      105      155      205</span></span>
<span><span class="co">#&gt; 5    5      102      154      206</span></span></code></pre></div>
<p>All forecast data columns (<code>val</code>, <code>val_*</code>) as
well as the <code>sim</code> column must be numeric.</p>
</div>
</div>
<div class="section level3">
<h3 id="forecast-list">Forecast input as lists<a class="anchor" aria-label="anchor" href="#forecast-list"></a>
</h3>
<p>Forecast data frames are straightforward representations forecasts,
though they are innefficient for raw forecast data as the
<code>time</code> column gets repeated for each realization. If you have
particularly long forecasts and/or many realizations, forecast data
frames can quickly grow large, which can be slow to work with. Instead,
you may wish to represent your forecast as a list.</p>
<p><a href="https://phac-nml-phrsd.github.io/casteval">casteval</a> accepts raw forecast data as a named list
with the following entries:</p>
<ul>
<li>
<code>time</code>: a single vector of times as numbers, dates, or
date-times</li>
<li>
<code>vals</code>: a list of numeric vectors containing the
forecasted values, one per realization, where each vector is the same
length as <code>time</code>
</li>
</ul>
<p>Since the individual realizations can be inferred from this casting,
there is no need to provide additional information to identify
individual realizations (as we did with the <code>sim</code> column <a href="#forecast-data-frame">above</a>) in order to enable related
downstream features.</p>
</div>
<div class="section level3">
<h3 id="forecast-object">
<code>create_forecast()</code><a class="anchor" aria-label="anchor" href="#forecast-object"></a>
</h3>
<p><strong>Forecast objects</strong> are created with
<code><a href="../reference/create_forecast.html">create_forecast()</a></code>. Its first argument is <code>dat</code>,
which is the forecast data in one of the formats described <a href="#create-a-forecast-object">above</a>.</p>
<p><code><a href="../reference/create_forecast.html">create_forecast()</a></code> accepts forecast metadata as
additional, optional arguments:</p>
<ul>
<li>
<code>name</code>: a label for the forecast. Plotting functions will
use <code>name</code> to title the plots they produce.</li>
<li>
<code>forecast_time</code>: the time at which the forecast period
begins in <code>dat</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Time series forecasts can typically be divided into a
fit period and a forecast period, distinguished by whether or not
observations were available at the time of forecast, respectively. It
can be useful in visualizing and/or scoring forecasts to distinguish
between these two periods.&lt;/p&gt;"><sup>1</sup></a>. The <code>forecast_time</code> format must
match that of the times in the <code>time</code> entry of
<code>dat</code>, and can be used in scoring functions to compute scores
only after times relative to <code>forecast_time</code>.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># forecast data with 4 time points and an ensemble of 3 simulations</span></span>
<span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  time<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  vals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">102</span>, <span class="fl">110</span>, <span class="fl">108</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">195</span>, <span class="fl">197</span>, <span class="fl">196</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">301</span>, <span class="fl">300</span>, <span class="fl">302</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_forecast.html">create_forecast</a></span><span class="op">(</span><span class="va">dat1</span>, name<span class="op">=</span><span class="st">"forecast 1"</span>, forecast_time<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the same data but formatted as a forecast data frame</span></span>
<span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  sim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, times<span class="op">=</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  val<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span>, <span class="fl">102</span>, <span class="fl">195</span>, <span class="fl">301</span>, <span class="fl">110</span>, <span class="fl">197</span>, <span class="fl">300</span>, <span class="fl">108</span>, <span class="fl">196</span>, <span class="fl">302</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_forecast.html">create_forecast</a></span><span class="op">(</span><span class="va">dat2</span>, name<span class="op">=</span><span class="st">"forecast 2"</span>, forecast_time<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fc1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "forecast 1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $forecast_time</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt;    time sim val</span></span>
<span><span class="co">#&gt; 1     1   1 100</span></span>
<span><span class="co">#&gt; 2     2   1 102</span></span>
<span><span class="co">#&gt; 3     3   1 110</span></span>
<span><span class="co">#&gt; 4     4   1 108</span></span>
<span><span class="co">#&gt; 5     1   2 200</span></span>
<span><span class="co">#&gt; 6     2   2 195</span></span>
<span><span class="co">#&gt; 7     3   2 197</span></span>
<span><span class="co">#&gt; 8     4   2 196</span></span>
<span><span class="co">#&gt; 9     1   3 300</span></span>
<span><span class="co">#&gt; 10    2   3 301</span></span>
<span><span class="co">#&gt; 11    3   3 300</span></span>
<span><span class="co">#&gt; 12    4   3 302</span></span>
<span><span class="co"># aside from the order of rows, the resulting forecast data frames are identical</span></span>
<span><span class="fu">waldo</span><span class="fu">::</span><span class="fu"><a href="https://waldo.r-lib.org/reference/compare.html" class="external-link">compare</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">fc1</span><span class="op">$</span><span class="va">data</span>, <span class="va">time</span><span class="op">)</span>, <span class="va">fc2</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No differences</span></span>
<span><span class="co"># mean-and-quantiles forecast data</span></span>
<span><span class="va">dat3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  val_q2.5<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">103</span>,<span class="fl">104</span>,<span class="fl">105</span>,<span class="fl">102</span><span class="op">)</span>,</span>
<span>  val_mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>,<span class="fl">155</span>,<span class="fl">160</span>,<span class="fl">155</span>,<span class="fl">154</span><span class="op">)</span>,</span>
<span>  val_q97.5<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">200</span>,<span class="fl">2204</span>,<span class="fl">205</span>,<span class="fl">206</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note how we omit `forecast_time`</span></span>
<span><span class="va">fc3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_forecast.html">create_forecast</a></span><span class="op">(</span></span>
<span>  <span class="va">dat3</span>,</span>
<span>  name<span class="op">=</span><span class="st">"forecast 3"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fc3</span><span class="op">)</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "forecast 3"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $forecast_time</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt;   time val_q2.5 val_mean val_q97.5</span></span>
<span><span class="co">#&gt; 1    1      100      150       200</span></span>
<span><span class="co">#&gt; 2    2      103      155       200</span></span>
<span><span class="co">#&gt; 3    3      104      160      2204</span></span>
<span><span class="co">#&gt; 4    4      105      155       205</span></span>
<span><span class="co">#&gt; 5    5      102      154       206</span></span></code></pre></div>
<p><code><a href="../reference/create_forecast.html">create_forecast()</a></code> returns a forecast object, which is a
list with the following fields:</p>
<ul>
<li>
<code>data</code>: a <a href="#forecast-data-frame">forecast data
frame</a>
</li>
<li>
<code>name</code>: the name of the forecast, if provided</li>
<li>
<code>forecast_time</code>: when the forecast was made, if
provided</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a forecast object with no optional metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    time<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>    val<span class="op">=</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span></span>
<span>  <span class="op">)</span>,</span>
<span>  name<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>  forecast_time<span class="op">=</span><span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt;   time val</span></span>
<span><span class="co">#&gt; 1    1   6</span></span>
<span><span class="co">#&gt; 2    2   7</span></span>
<span><span class="co">#&gt; 3    3   8</span></span>
<span><span class="co">#&gt; 4    4   9</span></span>
<span><span class="co">#&gt; 5    5  10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $forecast_time</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co"># a forecast object with metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    time<span class="op">=</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_date</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>    val<span class="op">=</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span></span>
<span>  <span class="op">)</span>,</span>
<span>  name<span class="op">=</span><span class="st">"A forecast"</span>,</span>
<span>  forecast_time<span class="op">=</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_date</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt;         time val</span></span>
<span><span class="co">#&gt; 1 1970-01-02   6</span></span>
<span><span class="co">#&gt; 2 1970-01-03   7</span></span>
<span><span class="co">#&gt; 3 1970-01-04   8</span></span>
<span><span class="co">#&gt; 4 1970-01-05   9</span></span>
<span><span class="co">#&gt; 5 1970-01-06  10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "A forecast"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $forecast_time</span></span>
<span><span class="co">#&gt; [1] "1970-01-04"</span></span></code></pre></div>
<p>This list could be created by hand, without the help of
<code><a href="../reference/create_forecast.html">create_forecast()</a></code>, but we recommend the latter approach as
<code><a href="../reference/create_forecast.html">create_forecast()</a></code> validates its inputs to avoid issues
downstream. For example, it checks that:</p>
<ul>
<li>
<code>forecast_time</code>’s type is consistent with
<code>data</code>
</li>
<li>quantile values are logically possible (<em>e.g.</em>, median values
can’t be smaller than the 25th quantiles)</li>
<li>there are no conflicting rows (<em>e.g.</em>, there can’t be two
rows with the same time reporting different means)</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="score-a-forecast">Score a forecast<a class="anchor" aria-label="anchor" href="#score-a-forecast"></a>
</h2>
<p>Forecasts are scored against observations, which must be passed to
<a href="https://phac-nml-phrsd.github.io/casteval">casteval</a> in a specific format.</p>
<div class="section level3">
<h3 id="observations-data-frame">Observations data frames<a class="anchor" aria-label="anchor" href="#observations-data-frame"></a>
</h3>
<p>Observations are passed to <a href="https://phac-nml-phrsd.github.io/casteval">casteval</a> in a data frame
with a <code>time</code> column and a <code>val_obs</code> column.
Similar to <span id="forecast-data-frame">forecast data frames</span>,
<code>time</code> may be either numeric, dates, or date-times.
<code>val_obs</code> must be numeric.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># An observations data frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  val_obs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">55</span>,<span class="fl">57</span>,<span class="fl">59</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   time val_obs</span></span>
<span><span class="co">#&gt; 1    1      50</span></span>
<span><span class="co">#&gt; 2    2      60</span></span>
<span><span class="co">#&gt; 3    3      55</span></span>
<span><span class="co">#&gt; 4    4      57</span></span>
<span><span class="co">#&gt; 5    5      59</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="scoring-functions">Scoring functions<a class="anchor" aria-label="anchor" href="#scoring-functions"></a>
</h3>
<p>We score a forecast using <code><a href="../reference/score.html">score()</a></code>, which has the
following parameters:</p>
<ul>
<li>
<code>fcsts</code> is either a forecast object or a list of forecast
objects</li>
<li>
<code>obs</code> is an observations data frame</li>
<li>
<code>fun</code> is a scoring function</li>
<li>
<code>...</code> are additional parameters which will be passed to
<code>fun</code>
</li>
</ul>
<p>Scoring functions which can be passed to <code><a href="../reference/score.html">score()</a></code>
include:</p>
<ul>
<li>
<code><a href="../reference/accuracy.html">accuracy()</a></code>, which calculates the success rate of a
forecast’s quantile range predictions</li>
<li>
<code><a href="../reference/crps.html">crps()</a></code>, which calculates the Continuous Ranked
Probability Score (CRPS) of a forecast</li>
<li>
<code><a href="../reference/log_score.html">log_score()</a></code>, which calculates the (positive)
logarithmic score of a forecast</li>
<li>
<code><a href="../reference/bias.html">bias()</a></code>, which calculates how much a forecast
overpredicts/underpredicts values</li>
</ul>
<p><code><a href="../reference/score.html">score()</a></code> scores every forecast passed to it against
<code>obs</code>, and returns a score for each one.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;If &lt;code&gt;fcsts&lt;/code&gt; is a list of forecast objects, a
list of scores will be returned. If &lt;code&gt;fcsts&lt;/code&gt; is a single
forecast object, a single score will be returned&lt;/p&gt;"><sup>2</sup></a></p>
<p>Below are examples of scoring. For a detailed explanation of how
scoring works, see the <a href="scoring.html">scoring vignette</a></p>
</div>
</div>
<div class="section level2">
<h2 id="visualize-forecast-evaluation">Visualize forecast evaluation<a class="anchor" aria-label="anchor" href="#visualize-forecast-evaluation"></a>
</h2>
<p><a href="https://phac-nml-phrsd.github.io/casteval">casteval</a> provides plotting functions which allow you
to visualize your forecasts, observations, and sometimes scores. Several
modular functions (<code><a href="../reference/plot_ensemble.html">plot_ensemble()</a></code>,
<code><a href="../reference/plot_observations.html">plot_observations()</a></code>, etc.) implement individual plotting
functionality, while the more user-friendly <code><a href="../reference/plot_forecast.html">plot_forecast()</a></code>
combines them all. We describe these functions below.</p>
<div class="section level3">
<h3 id="plot-a-forecast">Plot a forecast<a class="anchor" aria-label="anchor" href="#plot-a-forecast"></a>
</h3>
<p><code><a href="../reference/plot_forecast.html">plot_forecast()</a></code> plots a forecast and optionally overlays
observations and quantile intervals, scores the forecast, and
color-codes the observations based on score.</p>
<p>For raw forecast data, the <code>quant_intervals</code> parameter is
like the <code>quant_pairs</code> parameter in <code><a href="../reference/accuracy.html">accuracy()</a></code>,
and it is used to draw quantile intervals on the plot.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;It is named &lt;code&gt;quant_intervals&lt;/code&gt; and not
&lt;code&gt;quant_pairs&lt;/code&gt; so that it does not conflict when passing
&lt;code&gt;quant_pairs&lt;/code&gt; through the &lt;code&gt;...&lt;/code&gt; parameter to a
scoring function&lt;/p&gt;"><sup>3</sup></a></p>
<p>If <code>val_q50</code> is present in the forecast data, then the
median will be plotted. Similarly, if <code>val_mean</code> is present,
the mean will be plotted.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a forecast</span></span>
<span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_forecast.html">create_forecast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  time<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>  vals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">9</span>,<span class="fl">8</span>,<span class="fl">8</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">7</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">9</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"Forecast date: 2024-07-30"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot it</span></span>
<span><span class="fu"><a href="../reference/plot_forecast.html">plot_forecast</a></span><span class="op">(</span><span class="va">fc</span><span class="op">)</span></span></code></pre></div>
<p><img src="casteval_files/figure-html/plot_forecast_examples-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot it and display 3 quantile intervals</span></span>
<span><span class="fu"><a href="../reference/plot_forecast.html">plot_forecast</a></span><span class="op">(</span><span class="va">fc</span>, quant_intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">75</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>,<span class="fl">97.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="casteval_files/figure-html/plot_forecast_examples-2.png" width="700"></p>
<p>For summarized forecast data, if <code>val_q50</code> is present in
the forecast data, then the median will be plotted. Similarly, if
<code>val_mean</code> is present, the mean will be plotted.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a forecast with mean and median data</span></span>
<span><span class="va">fc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_forecast.html">create_forecast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  val_mean<span class="op">=</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>  val_q50<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.5</span>,<span class="fl">6</span>,<span class="fl">7.5</span>,<span class="fl">9</span>,<span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot it</span></span>
<span><span class="fu"><a href="../reference/plot_forecast.html">plot_forecast</a></span><span class="op">(</span><span class="va">fc2</span><span class="op">)</span></span></code></pre></div>
<p><img src="casteval_files/figure-html/plot_forecast_examples2-1.png" width="700"></p>
<div class="section level4">
<h4 id="plot-observations-with-scores">Plot observations with scores<a class="anchor" aria-label="anchor" href="#plot-observations-with-scores"></a>
</h4>
<p>If <code><a href="../reference/plot_forecast.html">plot_forecast()</a></code> is given observations and a scoring
function, it can additionally compute scores internally. Just pass a
scoring function to the <code>score</code> argument and
<code><a href="../reference/plot_forecast.html">plot_forecast()</a></code> will run
<code>score(fcst, obs, summarize=FALSE)</code> in order to plot the
forecast with observations colour-coded with the scores.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create some observations</span></span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>time<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, val_obs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">8</span>,<span class="fl">10</span>,<span class="fl">11</span>,<span class="fl">8</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot them over the forecast and its quantile intervals</span></span>
<span><span class="fu"><a href="../reference/plot_forecast.html">plot_forecast</a></span><span class="op">(</span><span class="va">fc</span>, obs<span class="op">=</span><span class="va">obs</span>, quant_intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">75</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>,<span class="fl">97.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="casteval_files/figure-html/plot_forecast_examples3-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Colour code points using `log_score()`</span></span>
<span><span class="co"># `plot_forecast()` automatically passes `summarize=FALSE` to</span></span>
<span><span class="co"># scoring functions in order to obtain the score for each day</span></span>
<span><span class="fu"><a href="../reference/plot_forecast.html">plot_forecast</a></span><span class="op">(</span><span class="va">fc</span>, obs<span class="op">=</span><span class="va">obs</span>, score<span class="op">=</span><span class="va">log_score</span>, quant_intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">97.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="casteval_files/figure-html/plot_forecast_examples3-2.png" width="700"></p>
<p>You can pass additional arguments to <code>score</code> through the
ellipsis parameter in <code><a href="../reference/plot_forecast.html">plot_forecast()</a></code>. For example, you can
specify quantile pairs to <code><a href="../reference/accuracy.html">accuracy()</a></code> using this method.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Identify the observations inside the 5%-95% quantile interval</span></span>
<span><span class="va">quant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">95</span><span class="op">)</span></span>
<span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_forecast.html">plot_forecast</a></span><span class="op">(</span><span class="va">fc</span>, obs<span class="op">=</span><span class="va">obs</span>, quant_intervals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">75</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>,<span class="fl">97.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">95</span><span class="op">)</span><span class="op">)</span>, score<span class="op">=</span><span class="va">accuracy</span>, quant_pairs<span class="op">=</span><span class="va">quant</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scoring accuracy using quantile pairs c(5, 95)</span></span>
<span><span class="va">pp</span></span></code></pre></div>
<p><img src="casteval_files/figure-html/plot_forecast_examples4-1.png" width="700"></p>
<p>The <code>invert_scale</code> parameter allows you to invert the
color scale for observations. For example, for Continuous Ranked
Probability Score, a lower score is better.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># don't invert the scale (default behaviour)</span></span>
<span><span class="fu"><a href="../reference/plot_forecast.html">plot_forecast</a></span><span class="op">(</span><span class="va">fc</span>, <span class="va">obs</span>, score<span class="op">=</span><span class="va">crps</span>, invert_scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="casteval_files/figure-html/invert_scale-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># invert the scale</span></span>
<span><span class="fu"><a href="../reference/plot_forecast.html">plot_forecast</a></span><span class="op">(</span><span class="va">fc</span>, <span class="va">obs</span>, score<span class="op">=</span><span class="va">crps</span>, invert_scale<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="casteval_files/figure-html/invert_scale-2.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="customize-the-output">Customize the output<a class="anchor" aria-label="anchor" href="#customize-the-output"></a>
</h4>
<p>Since <code><a href="../reference/plot_forecast.html">plot_forecast()</a></code> returns a
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot2::ggplot</a></code> object, you can further customize the plot
to suit your application:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">pp</span></span>
<span>  <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Days from forecast"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Hospital admissions"</span>,</span>
<span>    colour <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Observation predicted\nin {quant[1]}%-{quant[2]}% interval?"</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Quantile interval"</span>  </span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_colour_discrete</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`FALSE`<span class="op">=</span><span class="st">"No"</span>, `TRUE`<span class="op">=</span><span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="casteval_files/figure-html/plot_forecast_examples5-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="atomic-plotting-functions">Atomic plotting functions<a class="anchor" aria-label="anchor" href="#atomic-plotting-functions"></a>
</h3>
<p>Behind the scenes, <code><a href="../reference/plot_forecast.html">plot_forecast()</a></code> weaves together the
outputs of several helper functions to plot the different aspects of a
forecast. If you want further control over the visualization process,
you can use these functions directly. They are as follows:</p>
<ul>
<li>
<code><a href="../reference/plot_ensemble.html">plot_ensemble()</a></code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;See function documentation for parameters&lt;/p&gt;"><sup>4</sup></a> plots an ensemble of forecast
realizations<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;If the forecast contains a &lt;code&gt;sim&lt;/code&gt; column, the
realizations will be plotted as individual curves. Otherwise, the
forecast data will be plotted as points.&lt;/p&gt;"><sup>5</sup></a>
</li>
<li>
<code><a href="../reference/plot_observations.html">plot_observations()</a></code> plots a set of observations. If
those observations contain a <code>score</code> column, then the scores
will be used to colour-code the observations</li>
<li>
<code><a href="../reference/plot_quantiles.html">plot_quantiles()</a></code> plots the specified quantiles of a
forecast (quantiles can also be inferred from the forecast’s data
columns).</li>
<li>
<code><a href="../reference/plot_mean.html">plot_mean()</a></code> plots the mean of the forecast data</li>
<li>
<code><a href="../reference/plot_quant_intervals.html">plot_quant_intervals()</a></code> uses
<code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">ggplot2::geom_ribbon()</a></code> to plot bands of quantile
intervals</li>
<li>
<code><a href="../reference/plot_obs_score.html">plot_obs_score()</a></code> is a wrapper for
<code><a href="../reference/plot_observations.html">plot_observations()</a></code> which allows you to pass a scoring
function, scoring parameters, and a forecast to be scored</li>
</ul>
<p>All these functions consume a <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot2::ggplot</a></code> object as
their first parameter, and return a <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot2::ggplot</a></code> object
as well. This makes it possible to compose these functions in any order
using a pipe to produce the plot you want.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="../reference/plot_ensemble.html">plot_ensemble</a></span><span class="op">(</span>fcst <span class="op">=</span> <span class="va">fc</span><span class="op">)</span> </span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="../reference/plot_quant_intervals.html">plot_quant_intervals</a></span><span class="op">(</span><span class="va">fc</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">75</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="../reference/plot_mean.html">plot_mean</a></span><span class="op">(</span><span class="va">fc</span><span class="op">)</span> </span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="../reference/plot_obs_score.html">plot_obs_score</a></span><span class="op">(</span><span class="va">fc</span>, <span class="va">obs</span>, score<span class="op">=</span><span class="va">accuracy</span>, quant_pairs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Scoring accuracy using quantile pairs c(25, 75)</span></span></code></pre></div>
<p><img src="casteval_files/figure-html/other_plot_examples-1.png" width="700"></p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Yu, Irena Papst.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
